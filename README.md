# PowerShell Module: PSPoe

## Overview

PSPoe is a PowerShell module designed to streamline interaction with the Poe bot API. It offers two key functionalities:

`ConvertFrom-UglyJsonString`: A helper function that cleans and converts malformed JSON strings into valid JSON objects.

`Invoke-PoeQuery`: Interacts with the Poe bot API, sending system and user messages to generate text responses from LLMs hosted on Poe.com.

## Features

### ConvertFrom-UglyJsonString

The `ConvertFrom-UglyJsonString` function addresses the common challenge of dealing with malformed or "ugly" JSON strings. When JSON data contains irregularities such as extra curly braces or escaped characters, it can be difficult to parse and work with programmatically. This function provides a solution by:

- Detecting and ignoring unmatched curly braces to prevent parsing errors.
- Cleaning up the JSON string by removing unnecessary escape characters and line breaks.
- Converting the cleaned string into a valid JSON object, making it suitable for further processing or analysis in PowerShell scripts.

By seamlessly transforming malformed JSON strings into structured JSON objects, `ConvertFrom-UglyJsonString` enables smoother integration of JSON data into PowerShell workflows, improving efficiency and reliability in data handling tasks.

### Invoke-PoeQuery

The `Invoke-PoeQuery` function serves as a powerful interface to interact with the Poe bot API, facilitating dynamic conversations and text generation. This function enables users to send system and user messages to the Poe bot and receive text responses generated by the AI model. Key features of the function include:

- **Integration with the Poe Bot API**: This function seamlessly integrates with the Poe bot API, allowing users to harness the capabilities of the Poe conversational AI model directly from their PowerShell environment.

- **Message Composition**: Users can craft both system and user messages to be sent to the Poe bot API. System messages provide context or prompts for the conversation, while user messages represent the user's input or queries.

- **Customization Options**: The function offers various parameters for customization, including:
  - `jsonMode`: Enables JSON object mode, allowing users to receive JSON responses as PowerShell objects. 
  
    > **Note:** You still need to prompt your LLM to output JSON in the format you'd like. 
    
    > Try providing example JSON responses in the system message.

  - `temperature`: Adjusts the sampling temperature for text generation, influencing the diversity and creativity of the generated responses.
  - `skipSystemPrompt`: Allows users to skip system prompts if desired.
  - `logitBias`: Provides the ability to influence the probability distribution of tokens for more tailored responses.
  - `stopSequences`: Specifies sequences at which text generation should stop, providing control over response length.

- **Error Handling**: The function includes robust error handling mechanisms to gracefully handle API errors or connection issues. It provides informative error messages to aid in troubleshooting and debugging.

- **Flexibility and Automation**: With its PowerShell integration, this function enables automation of conversational interactions, making it suitable for various use cases such as chatbots, automated responses, or natural language processing tasks.

By leveraging the `Invoke-PoeQuery` function, PowerShell developers can seamlessly incorporate AI-driven conversational capabilities into their PowerShell scripts, enhancing productivity and enabling new possibilities for automation and interaction.

## Installation

### Manual Installation

1. Download the `PSPoe` module directory.
2. Copy the `PSPoe` directory to one of the following PowerShell module paths:
   - Current User: `$env:USERPROFILE\Documents\WindowsPowerShell\Modules`
   - All Users: `$env:ProgramFiles\WindowsPowerShell\Modules`
3. Import the module using `Import-Module PSPoe`.

### PowerShell Gallery (Coming Soon)

The module will soon be available on the PowerShell Gallery for easy installation using `Install-Module -Name PSPoe`.

## Usage

### ConvertFrom-UglyJsonString

```powershell
# Example Usage
$malformedJsonString = '{"name": "John", "age": 30, "city": "New York"}{invalidJson}'
$cleanJsonObject = ConvertFrom-UglyJsonString -InputString $malformedJsonString
```

### Invoke-PoeQuery

```powershell
# Example Usage
$systemMessages = "You are a pirate."
$userMessages = "Tell a story."
Invoke-PoeQuery -botName "chatgpt" -apiKey "your-api-key" -systemMessages $systemMessages -userMessages $userMessages
```

## API Key

Go here: https://poe.com/api_key

## "Official" Bot Names

I believe this module will only work with "official" bots hosted by Poe.com. YMMV.

The list below could change and I haven't tested them all. There are others that are not on this list. You can use dev tools in Chrome/Edge/Firefox while chatting with an LLM on Poe.com to try and find the bot name.

Note: solar-mini works well and it is the cheapest to query, at only 1 Poe.com "point" per query. Paying members get 1 million points / month. 

Chatgpt is 20 points per query. Mixtral-8x7b-Groq is also very good (and speedy) and only 10 points. 

GPT-4-128k is 2500 points per message, at the higher end.

- Claude-3-Opus
- Claude-3-Sonnet
- Claude-3-Opus-200k
- Claude-3-Sonnet-200k
- Claude-instant-100k
- Claude-2
- Claude-2-100k
- Claude-instant
- ChatGPT
- GPT-3.5-Turbo
- GPT-3.5-Turbo-Instruct
- ChatGPT-16k
- GPT-4
- GPT-4-128k
- Google-PaLM
- Llama-2-7b
- Llama-2-13b
- Llama-2-70b
- Code-Llama-7b
- Code-Llama-13b
- Code-Llama-34b
- Solar-Mini
- mixtral-8x7b-Groq


## Example Use Case: Convert Folder of Ansible YML to PowerShell DSC

```powershell
# Import PSPoe module
Import-Module PSPoe

# Define the path to the directory containing Ansible files
$ansibleDirectory = "C:\Path\To\Ansible\Files"

# Get all Ansible files in the directory
$ansibleFiles = Get-ChildItem -Path $ansibleDirectory -Filter *.yml

# Loop through each Ansible file
foreach ($file in $ansibleFiles) {
    # Read the contents of the Ansible file
    $ansibleContent = Get-Content -Path $file.FullName -Raw

    # Define the system message to instruct the LLM for conversion
    $systemMessage = @"
    Convert the following Ansible playbook to PowerShell DSC format:
"@

    # Use Invoke-PoeQuery to send the request to the Poe bot API
    $dscContent = Invoke-PoeQuery -botName "chatgpt" -apiKey "your-api-key" `
                                  -systemMessages $systemMessage `
                                  -userMessages $ansibleContent

    # Output or save the converted PowerShell DSC
    # For example, save to a file with the same name but with a .ps1 extension
    $dscFilePath = [IO.Path]::ChangeExtension($file.FullName, ".ps1")
    $dscContent | Out-File -FilePath $dscFilePath
}

# Output completion message
Write-Output "Conversion of Ansible playbooks to PowerShell DSC completed."
```

## Contributing

Contributions are welcome! If you encounter any issues or have suggestions for improvements, please feel free to open an issue or submit a pull request on [GitHub](https://github.com/jmangold23/pspoe).

## License

PSPoe is licensed under the [MIT License](https://github.com/jmangold23/pspoe/blob/main/LICENSE).

